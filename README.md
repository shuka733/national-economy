# ナショナルエコノミー — Web版

> ボードゲーム「ナショナルエコノミー」をブラウザ上で完全再現したWebアプリケーションです。  
> 基本セットとGlory拡張に対応し、2〜4人でのローカル対戦・CPU対戦・P2Pオンライン対戦が楽しめます。

**🌐 オンラインプレイ**: [https://shuka733.github.io/national-economy/](https://shuka733.github.io/national-economy/)
**💻 ローカルホスト**: [http://localhost:5173/national-economy/](http://localhost:5173/national-economy/)

---

## 目次

- [ゲーム概要](#ゲーム概要)
- [起動方法](#起動方法)
- [プレイモード](#プレイモード)
- [ゲームルール](#ゲームルール)
- [建物カード一覧（基本セット）](#建物カード一覧基本セット)
- [Glory拡張カード](#glory拡張カード)
- [オンライン対戦（P2P）の遊び方](#オンライン対戦p2pの遊び方)
- [操作方法](#操作方法)
- [技術スタック](#技術スタック)

---

## ゲーム概要

「ナショナルエコノミー」は、プレイヤーが経営者となり、**ワーカー（労働者）を職場に配置**して資源を集め、**建物を建設**してVP（勝利点）を稼ぐワーカープレイスメントゲームです。

### ゲームの特徴

- **閉じた経済圏**: お金は「家計」と「プレイヤー」の間を循環します。売却で得たお金は家計から出て、給料日に家計へ戻ります。家計が空になると売却ができなくなるため、**お金の流れを読む戦略力**が問われます。
- **賃金の重圧**: ラウンドが進むほどワーカー1人あたりの賃金が上がるため、やみくもにワーカーを増やすと破綻します。**増員のタイミング**がゲームを決定づけます。
- **建てて、使って、売る**: 建物はVPをもつ資産ですが、給料支払いのために売却を迫られることもあります。**何を建て、何を守り、何を手放すか**の判断がプレイヤーの腕の見せ所です。
- **9ラウンドの密度**: 全9ラウンdrのコンパクトな構成の中に、序盤のエンジン構築・中盤の拡大・終盤のVP追い込みが凝縮されています。

### このWeb版の機能

| 機能 | 内容 |
|------|------|
| **対応人数** | 2〜4人 |
| **ゲームバージョン** | 基本セット / Glory拡張 |
| **プレイモード** | ホットシート / CPU対戦 / P2Pオンライン |
| **CPU難易度** | Standard（ランダム） / Hard（ヒューリスティックAI） |
| **CPU思考時間** | 0〜2000msで自由に調節可能 |
| **BGM/効果音** | 複数のBGMトラック + 100種類以上の効果音 |
| **レスポンシブ** | PC・タブレット・スマートフォン対応 |
| **サーバー不要** | P2PはPeerJSを利用し、サーバーレスで動作 |

---

## 起動方法

### 開発サーバー

```bash
cd national-economy
npm install
npm run dev
```

ブラウザで `http://localhost:5173/national-economy/` を開いてください。

### 本番ビルド

```bash
npm run build
npm run preview
```

---

## プレイモード

### 🎮 ホットシート（ローカル対戦）

1台のPCで複数人が交互にプレイするモードです。CPU対戦をOFFにすれば全員手動操作、ONにすれば指定したプレイヤーをCPUが自動操作します。

### 🤖 CPU対戦

CPU Opponentを有効にして、人間 vs CPUの対戦ができます。

| 設定項目 | 説明 |
|---------|------|
| **難易度 Standard** | ランダムに行動を選択。初心者の練習相手に最適 |
| **難易度 Hard** | ヒューリスティックAIで最適な一手を選択。経験者でも手強い |
| **CPU Speed** | 思考遅延を0〜2000msで設定。0msで瞬時、大きいほど考え込む演出に |
| **Assignments** | P1〜P4の各プレイヤーを人間/CPUに個別設定可能 |

ゲーム中も画面右上の🤖ボタンからCPU思考速度をリアルタイムに変更できます。

### 🌐 P2Pオンライン対戦

PeerJSを使った端末間直接接続で、専用サーバーなしでオンライン対戦ができます。  
詳細は[オンライン対戦（P2P）の遊び方](#オンライン対戦p2pの遊び方)を参照してください。

---

## ゲームルール

### セットアップ

| 項目 | 内容 |
|------|------|
| プレイヤー | 2〜4人 |
| 初期ワーカー | 各2体 |
| 初期手札 | 各3枚（建物カード） |
| 初期所持金 | P1: $5 / P2: $6 / P3: $7 / P4: $8 |
| 初期家計 | $0（ゲーム開始時は空） |

※ 2人プレイでは一部公共職場の仕様が変わります（詳細はゲーム内で確認）。

### ラウンドの流れ（全9ラウンド）

各ラウンドは以下の3つのフェイズで構成されます。

#### 1. 仕事フェイズ（ワーカー配置）

スタートプレイヤーから順番に、**手持ちのワーカーを1体ずつ**職場に配置します。配置と同時に職場の効果が発動します。全プレイヤーのワーカーを使い切るまで繰り返します。

**配置のルール**:
- 他のプレイヤーが既に配置した職場には配置できません（複数配置可の職場を除く）
- 自分の建物には自分だけが配置できます
- 公共職場（売られた建物）は誰でも使えます

#### 2. 給料日フェイズ

ワーカー数 × 賃金を支払います。
- お金は**プレイヤーの手元から家計**に移動します
- 資金不足の場合、建物を売却して補填できます（建物のVP = 売却額）
- それでも不足する場合、**未払い賃金カード**（-3VP/枚）が発行されます

#### 3. 精算フェイズ

手札が上限枚数を超えている場合、超過分を捨てます。
- 基本上限: **5枚**
- 倉庫を建設すると **+4枚**（最大9枚）

### 賃金テーブル

| ラウンド      | 1人あたりの賃金 |
|:------------|:-------------|
| R1〜R2       | $2            |
| R3〜R5       | $3            |
| R6〜R7       | $4            |
| R8〜R9       | $5            |

### お金の循環システム

ナショナルエコノミーの最大の特徴は、お金が閉じた系の中で循環することです。

```
  ┌──────────┐         売却収入          ┌──────────┐
  │          │ ←───────────────────────  │          │
  │   家計    │                          │  プレイヤー │
  │          │ ────────────────────────→ │          │
  └──────────┘         給料支払い          └──────────┘
```

- **家計 → プレイヤー**: 売却系職場（露店、市場等）で消費財を売ると、家計からお金を得ます
- **プレイヤー → 家計**: 給料日に賃金を支払うと、お金が家計に戻ります
- **家計が空だと売却できない**: お金が循環しきって家計に残っていないと、高額売却職場に配置しても成果が出ません

### ラウンド追加公共職場

ゲームの進行に応じて新しい公共職場が追加されます。

| R  | 職場名           | 効果                        | 複数配置 |
|:---|:----------------|:---------------------------|:--------|
| 初期 | 鉱山              | 建物カード1枚引く              | ∞       |
| 初期 | 大工              | 建物を1つ建設する              | ×       |
| 初期 | 学校              | ワーカーを3人に増員            | ×       |
| 2  | 露店              | 消費財1枚捨て → 家計から$6     | ∞       |
| 3  | 市場              | 消費財2枚捨て → 家計から$12    | ×       |
| 4  | 高等学校          | ワーカーを4人に増員             | ×       |
| 5  | スーパーマーケット  | 消費財3枚捨て → 家計から$18    | ∞       |
| 6  | 大学              | ワーカーを5人に増員             | ×       |
| 7  | 百貨店            | 消費財4枚捨て → 家計から$24     | ×       |
| 8  | 専門学校          | ワーカー+1（即使用可能）         | ×       |
| 9  | 万博              | 消費財5枚捨て → 家計から$30    | ∞       |

### カードの種類

手札には2種類のカードが存在します。

| 種類 | 説明 |
|------|------|
| **建物カード** | 建設して場に出せるカード。コストとして手札を捨てて建設します |
| **消費財カード** | 農場などで生産される「売り物」。売却職場で家計のお金に変換できます |

### 勝利点（VP）計算

ゲーム終了時（R9の精算後）、以下を合計してVPが最も高いプレイヤーの勝利です。

| 項目 | 計算方法 |
|------|---------|
| 建物VP | 建設済み建物のVPを合計 |
| 所持金 | 残りのお金（$1 = 1VP） |
| 未払い賃金 | 未払いカード1枚につき **-3VP** |
| ボーナス建物 | 不動産屋・農協・労働組合・本社ビル・鉄道の特殊効果 |
| VPトークン | Glory拡張のみ。3枚セットで10点、端数は1枚1点 |

---

## 建物カード一覧（基本セット）

カード総数: **64枚**（16種類）

### コスト1（16枚）

| カード名       | 枚数 | VP  | タグ   | 効果 |
|:-------------|:-----|:----|:------|:-----|
| 農場          | 8    | 6   | 🌾農園 | 消費財を2枚引く |
| 焼畑          | 2    | 0   | 🌾農園 🔒 | 消費財を5枚引く。**使用後消滅** |
| 珈琲店        | 2    | 8   | —     | 家計から$5を得る |
| 設計事務所    | 4    | 8   | —     | 山札5枚公開→1枚を手札に、残りは捨て札 |

### コスト2（21枚）

| カード名       | 枚数 | VP  | タグ   | 効果 |
|:-------------|:-----|:----|:------|:-----|
| 工場          | 8    | 12  | 🏭工場 | 手札2枚捨て→4枚引く（実質+2） |
| 建設会社      | 4    | 10  | —     | 建物を1つ建設する（建設コスト-1） |
| 倉庫          | 3    | 10  | 🔒    | 手札上限+4（5→9枚） |
| 法律事務所    | 1    | 8   | 🔒    | 終了時、未払い賃金5枚まで免除 |
| 果樹園        | 3    | 10  | 🌾農園 | 手札が4枚になるまで消費財を引く |
| 社宅          | 2    | 8   | 🔒    | ワーカー上限+1 |

### コスト3（10枚）

| カード名       | 枚数 | VP  | タグ   | 効果 |
|:-------------|:-----|:----|:------|:-----|
| 不動産屋      | 2    | 10  | 🔒    | **終了ボーナス**: 所有建物1つにつき+3VP |
| 開拓民        | 2    | 14  | —     | 手札の🌾農園を1つ**無料**建設 |
| レストラン    | 2    | 16  | —     | 手札1枚捨て→家計から$15 |
| 大農園        | 3    | 12  | 🌾農園 | 消費財を3枚引く |
| 農協          | 1    | 12  | 🔒    | **終了ボーナス**: 手札の消費財1枚につき+3VP |

### コスト4（10枚）

| カード名       | 枚数 | VP  | タグ   | 効果 |
|:-------------|:-----|:----|:------|:-----|
| ゼネコン      | 3    | 18  | —     | 建物1つ建設→カード2枚引く |
| 製鉄所        | 3    | 20  | 🏭工場 | 建物カードを3枚引く |
| 邸宅          | 1    | 28  | 🔒    | 効果なし（高VP） |
| 化学工場      | 2    | 18  | 🏭工場 | 建物カード2枚引く（手札0枚なら4枚引く） |
| 労働組合      | 1    | 0   | 🔒    | **終了ボーナス**: ワーカー1人につき+6VP |

### コスト5（7枚）

| カード名       | 枚数 | VP  | タグ   | 効果 |
|:-------------|:-----|:----|:------|:-----|
| 自動車工場    | 3    | 24  | 🏭工場 | 手札3枚捨て→7枚引く（実質+4） |
| 本社ビル      | 1    | 20  | 🔒    | **終了ボーナス**: 🔒マーク建物1つにつき+6VP |
| 二胡市建設    | 2    | 20  | —     | 同コスト建物2つを同時建設（コスト1つ分） |
| 鉄道          | 1    | 18  | 🔒    | **終了ボーナス**: 🏭工場1つにつき+8VP |

> **🔒マーク** = 売却不可（給料日に売ることができない）

---

## Glory拡張カード

Glory拡張を選択すると、基本セットに加えて**71枚の新カード**（25種類）が追加されます。

### 主な新要素

| 要素 | 説明 |
|------|------|
| **VPトークン** | 一部の建物使用時に獲得。終了時、3枚セットで10点・端数は1枚1点 |
| **コスト0カード** | 遺物（VPトークン獲得）など |
| **ワーカー2体要求** | 一部のGlory建物（炭鉱・綿花農場・転送装置）は起動に2体のワーカーが必要 |
| **機械人形** | 建設すると即座にロボットワーカー+1体獲得（給料不要） |
| **可変コスト** | VPトークンの所持数に応じて建設コストが下がるカード |
| **終了時ボーナス建物** | 消費者組合・ギルドホール・象牙の塔・革命広場・収穫祭・技術展示会・浄火の神殿 |

### Glory拡張カード一覧

カード総数: **71枚**（25種類）

#### コスト0（3枚）

| カード名 | 枚数 | VP | 効果 |
|:---------|:-----|:---|:-----|
| 遺物 | 3 | 0 | 🔒 VPトークン2枚を得る |

#### コスト1（16枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 農村 | 6 | 6 | 🌾農園 | 消費財2枚引く OR 消費財2枚捨てて建物カード3枚引く |
| 植民団 | 5 | 6 | — | 建物を1つ建てる。その後、消費財1枚引く |
| 工房 | 5 | 8 | 🏭工場 | 建物カード1枚引く + VPトークン1枚獲得 |

#### コスト2（18枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 蒸気工場 | 8 | 10 | 🏭工場 | 手札2枚捨て → 建物カード4枚引く（VPトークン2枚以上でコスト-1） |
| 養鶏場 | 4 | 12 | 🌾農園 | 消費財2枚引く（手札枚数が奇数なら3枚引く） |
| 摩天建設 | 3 | 10 | — | 建物を1つ建てる（その後手札が0枚なら建物カード2枚引く） |
| ゲームカフェ | 3 | 10 | — | 家計から$5得る（ラウンド最後の行動なら$10得る） |

#### コスト3（8枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 綿花農場 | 3 | 14 | 🌾農園 | 消費財5枚引く（⚠️ワーカー2体必要） |
| 美術館 | 2 | 14 | — | 家計から$7得る（手札がちょうど5枚なら$14得る） |
| 記念碑 | 2 | 24 | 🔒 | 効果なし（高VP） |
| 消費者組合 | 1 | 18 | 🔒 | **終了ボーナス**: 農業の資産価値合計20以上で+18点 |

#### コスト4（13枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 機械人形 | 5 | 2 | 🔒 | 機械人形コマ（ロボットワーカー）を1つ得る。即座に使用可能。給料不要 |
| 炭鉱 | 2 | 20 | — | 建物カード5枚引く（⚠️ワーカー2体必要） |
| モダニズム建設 | 2 | 18 | — | 建物を1つ建てる（この建設で消費財は2枚分のコストになる） |
| 劇場 | 2 | 20 | — | 手札2枚捨てて、家計から$20得る |
| ギルドホール | 1 | 20 | 🔒 | **終了ボーナス**: 農業と工業両方所持で+20点 |
| 象牙の塔 | 1 | 22 | 🔒 | **終了ボーナス**: VPトークン7枚以上で+22点 |

#### コスト5（8枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 精錬所 | 3 | 16 | 🏭工場 | 建物カード3枚引く（VPトークン3枚以上でコスト-2） |
| 転送装置 | 2 | 22 | — | 建物を1つ**コスト無視（無料）**で建てる（⚠️ワーカー2体必要） |
| 革命広場 | 1 | 18 | 🔒 | **終了ボーナス**: 人間の労働者が5人で+18点 |
| 収穫祭 | 1 | 26 | 🔒 | **終了ボーナス**: 手札に消費財が4枚以上あれば+26点 |
| 技術展示会 | 1 | 24 | 🔒 | **終了ボーナス**: 工業の資産価値合計が30以上で+24点 |

#### コスト6（3枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 温室 | 2 | 18 | 🌾農園 | 消費財4枚引く（VPトークン4枚以上でコスト-2） |
| 浄火の神殿 | 1 | 30 | 🔒 | **終了ボーナス**: これが唯一の売却不可カードなら+30点 |

#### コスト7（2枚）

| カード名 | 枚数 | VP | タグ | 効果 |
|:---------|:-----|:---|:-----|:-----|
| 機関車工場 | 2 | 24 | 🏭工場 | 手札3枚捨て → 建物カード7枚引く（VPトークン5枚以上でコスト-3） |

> **🔒** = 売却不可（給料日に売ることができない）  
> **⚠️ワーカー2体必要** = 配置にワーカーが2体必要

---

## オンライン対戦（P2P）の遊び方

PeerJSを使ったP2P通信のため、専用サーバーは不要です。  
**インターネット** と **LAN（同じWi-Fi）** の2つの方法でプレイできます。

---

### 🌐 インターネット対戦（おすすめ）

GitHub Pagesに公開済みのため、URLを共有するだけですぐにプレイできます。

**公開URL**: [https://shuka733.github.io/national-economy/](https://shuka733.github.io/national-economy/)

#### 手順
1. **ホスト**: 上記URLを開く →「🌐 オンライン対戦」→「🏠 ゲームを作成（ホスト）」
2. **ホスト**: プレイヤー人数を設定し、表示された**Peer ID**をゲストに共有（LINE、Discord等）
3. **ゲスト**: 同じURLを開く →「🌐 オンライン対戦」→「🔗 ゲームに参加」
4. **ゲスト**: Peer IDを入力 →「🔗 接続する」
5. **ホスト**: 全員の接続を確認後「🚀 ゲーム開始！」

> **CPUオートプレイ**: ホスト/ゲストそれぞれが「🤖 CPUオートプレイ」をONにすると、自分の手番をCPUが自動で操作します。全員ONにすればCPU同士の観戦も可能です。

---

### 📶 LAN対戦（同じWi-Fi内）

開発サーバーを使ってローカルネットワーク内で対戦します。

#### 前提条件
- 2台以上のPCが**同じWi-Fiネットワーク**に接続されていること
- ホストPC（開発サーバーを動かすPC）で `npm run dev` を実行済みであること

#### 手順
1. ホストPCで `npm run dev` を実行
2. ターミナルに表示される **Network** のURL（例: `http://192.168.x.x:5173/`）を確認
3. **ホスト**: `http://localhost:5173/national-economy/` を開く →「🏠 ゲームを作成」→ Peer IDをゲストに共有
4. **ゲスト**: `http://192.168.x.x:5173/national-economy/` を開く →「🔗 ゲームに参加」→ Peer IDを入力
5. **ホスト**: 全員の接続を確認後「🚀 ゲーム開始！」

---

### トラブルシューティング

| 症状 | 対処法 |
|------|--------|
| 接続できない（インターネット） | ブラウザのコンソールでエラーを確認し、ページをリロードして再試行。企業VPN等の制限的なネットワークでは接続できない場合があります |
| アクセスできない（LAN） | Windows Defenderファイアウォールでポート（5173等）のプライベートネットワーク通信を許可してください |
| Peer ID接続が切れる | ネットワークが不安定な場合、ページを再読込して再接続してください |
| ゲームが進行しない | CPU設定やネットワーク状況を確認してください。P2Pオートプレイのバグは最新版で修正済みです |

---

## 操作方法

### 基本操作

| 操作 | 方法 |
|------|------|
| ワーカー配置 | 緑色にハイライトされた職場をクリック |
| 個人建物への配置 | 自分の場の建物カードをクリック |
| 建設 | 建設モーダルで手札のカードをクリック → コスト分の手札を選択 |
| 売却（消費財） | 売却系職場に配置後、自動的に消費財が売られます |
| 給料日の売却 | 売却可能な建物を選択 → 支払い確定 |
| カード廃棄 | モーダルで捨てるカードを選択 → 確定ボタン |

### UI要素

| アイコン | 機能 |
|---------|------|
| 🔊 / 🔇 | BGM/効果音のミュート切替 |
| ⚙️ | サウンド詳細設定（BGM音量・SFX音量） |
| 🤖 | CPU思考速度の設定（ゲーム中にリアルタイム変更可能） |
| 📋 | ゲームログの表示/非表示 |
| 🃏 | 捨て札の確認 |

---

## 技術スタック

| カテゴリ | 技術 |
|---------|------|
| **フレームワーク** | React 19 + TypeScript |
| **ビルドツール** | Vite 6 |
| **ゲームエンジン** | boardgame.io（状態管理・ターン制御） |
| **スタイリング** | Tailwind CSS v4 |
| **P2P通信** | PeerJS（WebRTC） |
| **デプロイ** | GitHub Pages |
| **サウンド** | Web Audio API（BGM + SFX） |

---

## ライセンス

「ナショナルエコノミー」はスパ帝国（Supa Teikoku）のボードゲームです。  
このWeb版は個人の学習・趣味目的で制作されたファンメイド作品です。
