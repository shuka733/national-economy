// ============================================================
// acceptance.test.ts â€” â‘£ å—ã‘å…¥ã‚Œãƒ†ã‚¹ãƒˆï¼ˆE2E ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•æ“ä½œï¼‰
// Playwrightã‚’ä½¿ç”¨ã—ã¦å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§UIã‚’æ“ä½œã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹
// å®Ÿè¡Œå‰ã«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆè‡ªå‹•èµ·å‹•è¨­å®šæ¸ˆã¿ï¼‰
// ============================================================
import { test, expect } from '@playwright/test';

const BASE_URL = 'http://localhost:5173/national-economy/';

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘ : ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã®è¡¨ç¤º
// ============================================================
test('â‘  ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    await page.goto(BASE_URL);

    // National Economyã¨ã„ã†ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨
    await expect(page.locator('text=National Economy')).toBeVisible();

    // ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
    await expect(page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰')).toBeVisible();
    await expect(page.locator('text=ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦ï¼ˆP2Pï¼‰')).toBeVisible();
});

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘¡: ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ã®è¨­å®šç”»é¢ã«é·ç§»ã§ãã‚‹
// ============================================================
test('â‘¡ ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è¨­å®šç”»é¢ã«ç§»å‹•ã™ã‚‹', async ({ page }) => {
    await page.goto(BASE_URL);

    // ã€ŒğŸ® ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
    await page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰').click();

    // è¨­å®šç”»é¢ã®ã‚¿ã‚¤ãƒˆãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    await expect(page.locator('text=ãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆè¨­å®š')).toBeVisible();

    // äººæ•°é¸æŠï¼ˆ2ã€œ4äººï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    // â€»æ•°å­—ãƒœã‚¿ãƒ³ã¨ä»–ã®P2ãªã©ã®ãƒœã‚¿ãƒ³ãŒé‡è¤‡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚first()ã§å–å¾—
    await expect(page.locator('button:has-text("2")').first()).toBeVisible();
    await expect(page.locator('button:has-text("3")').first()).toBeVisible();
    await expect(page.locator('button:has-text("4")').first()).toBeVisible();

    // Basicãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    await expect(page.locator('text=Basic')).toBeVisible();

    // Gloryãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    await expect(page.locator('text=Glory')).toBeVisible();
});

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘¢: ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã—ã¦ã‚²ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
// ============================================================
test('â‘¢ ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆãƒ©ã‚¦ãƒ³ãƒ‰è¡¨ç¤ºï¼‰ãŒç¾ã‚Œã‚‹', async ({ page }) => {
    await page.goto(BASE_URL);

    // â‘  ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ã¸
    await page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰').click();

    // â‘¡ 2äººãƒ»Basicã‚’é¸æŠï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ï¼‰

    // â‘¢ ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
    await page.locator('text=ã‚²ãƒ¼ãƒ é–‹å§‹').click();

    // ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ç”»é¢ã«ãƒ©ã‚¦ãƒ³ãƒ‰è¡¨ç¤ºãŒç¾ã‚Œã¦ã„ã‚‹ã“ã¨
    await expect(page.locator('text=Round')).toBeVisible({ timeout: 10000 });
});

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘£: ã‚²ãƒ¼ãƒ é–‹å§‹å¾Œã«å…¬å…±è·å ´ãŒè¡¨ç¤ºã•ã‚Œã‚‹
// ============================================================
test('â‘£ ã‚²ãƒ¼ãƒ ç”»é¢ã«å…¬å…±è·å ´ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    await page.goto(BASE_URL);
    await page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰').click();
    await page.locator('text=ã‚²ãƒ¼ãƒ é–‹å§‹').click();

    // å…¬å…±è·å ´ï¼ˆWorkplaceï¼‰ã‚¨ãƒªã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨
    // ã€Œå¤§å·¥ã€ã€Œé›‘ç”¨ã€ãªã©ã®å…¬å…±è·å ´åãŒç”»é¢ã«å­˜åœ¨ã™ã‚‹ã‹ã€
    // ã¾ãŸã¯å…¬å…±è·å ´ã‚’å«ã‚€ã‚¨ãƒªã‚¢ã®ãƒ©ãƒ™ãƒ«ãŒè¦‹ãˆã‚‹ã‹ç¢ºèª
    await expect(page.locator('text=Round')).toBeVisible({ timeout: 10000 });

    // ä½•ã‹ã—ã‚‰ãƒœã‚¿ãƒ³ï¼ˆãƒ¯ãƒ¼ã‚«ãƒ¼é…ç½®ã§ãã‚‹å ´æ‰€ï¼‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨
    const buttons = page.locator('button');
    const count = await buttons.count();
    expect(count).toBeGreaterThan(0);
});

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘¤: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã§ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹
// ============================================================
test('â‘¤ è¨­å®šç”»é¢ã‹ã‚‰ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ã€ã§ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹', async ({ page }) => {
    await page.goto(BASE_URL);
    await page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰').click();

    // è¨­å®šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨
    await expect(page.locator('text=ãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆè¨­å®š')).toBeVisible();

    // ã€Œâ† ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
    await page.locator('text=ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹').click();

    // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã«æˆ»ã£ã¦ã„ã‚‹ã“ã¨
    await expect(page.locator('text=National Economy')).toBeVisible();
    await expect(page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰')).toBeVisible();
});

// ============================================================
// ã‚·ãƒŠãƒªã‚ªâ‘¥: CPUå…¨å“¡ã§ä¸€å±€ãƒ—ãƒ¬ã‚¤ã—ã¦ã€Œã‚²ãƒ¼ãƒ çµ‚äº†ï¼ã€ã¾ã§åˆ°é”ã™ã‚‹
// â€»å…¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’CPU(heuristic)ã«è¨­å®šã—ã¦è‡ªå‹•ãƒ—ãƒ¬ã‚¤
// ============================================================
test('â‘¥ CPUå…¨å“¡ãƒ—ãƒ¬ã‚¤ã§æœ€å¾Œã¾ã§é€²ã‚“ã§ã‚²ãƒ¼ãƒ çµ‚äº†ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’5åˆ†ã«è¨­å®šï¼ˆã‚²ãƒ¼ãƒ 1å±€åˆ†ã®ä½™è£•ã‚’æŒãŸã›ã‚‹ï¼‰
    test.setTimeout(300000);

    await page.goto(BASE_URL);

    // â‘  ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ã¸
    await page.locator('text=ãƒ­ãƒ¼ã‚«ãƒ«å¯¾æˆ¦ï¼ˆãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆï¼‰').click();
    await expect(page.locator('text=ãƒ›ãƒƒãƒˆã‚·ãƒ¼ãƒˆè¨­å®š')).toBeVisible();

    // â‘¢ CPUå¯¾æˆ¦ã‚’ONã«ã™ã‚‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆONã§å…¨å“¡CPUã®ã¯ãšãªã®ã§ãã®ã¾ã¾ï¼‰
    // â€»P1ãƒœã‚¿ãƒ³ã¯ã‚¯ãƒªãƒƒã‚¯ã—ãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§P1ã‚‚CPU=trueã«ãªã£ã¦ã„ã‚‹ï¼‰

    // â‘£ CPUé€Ÿåº¦ã‚’æœ€é€Ÿï¼ˆ0msï¼‰ã«è¨­å®š
    // Reactã®ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¯fill()ã ã¨changeã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„ãŸã‚evaluateã§ç›´æ¥å¤‰æ›´ã™ã‚‹
    const speedSlider = page.locator('input[type="range"]');
    if (await speedSlider.count() > 0) {
        await speedSlider.first().evaluate((el: HTMLInputElement) => {
            el.value = '0';
            el.dispatchEvent(new Event('input', { bubbles: true }));
            el.dispatchEvent(new Event('change', { bubbles: true }));
        });
    }

    // â‘¤ ã‚²ãƒ¼ãƒ é–‹å§‹
    await page.locator('text=ã‚²ãƒ¼ãƒ é–‹å§‹').click();

    // ã‚²ãƒ¼ãƒ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
    await expect(page.locator('text=Round')).toBeVisible({ timeout: 10000 });

    // â‘¥ CPUãŒè‡ªå‹•ãƒ—ãƒ¬ã‚¤ã—ã¦ã€Œã‚²ãƒ¼ãƒ çµ‚äº†ï¼ã€ãŒç¾ã‚Œã‚‹ã¾ã§å¾…ã¤
    await expect(page.locator('text=ã‚²ãƒ¼ãƒ çµ‚äº†ï¼')).toBeVisible({ timeout: 300000 });

    // â‘¦ P1ã®ã‚¹ã‚³ã‚¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨
    await expect(page.locator('text=P1')).toBeVisible();

    // â‘§ VPãŒæ•°å€¤ã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆä¾‹: "42VP"ï¼‰
    const pageText = await page.textContent('body');
    expect(pageText).toMatch(/\d+VP/);
});
